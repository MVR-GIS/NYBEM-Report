## Pre-Processing Functions (I)


<span style="color: red;">Need Dougherty's help on this one.</span>

Insert pre-amble text. This chapter describes each function in detail, but they can be summarized briefly as:  


### Define Model Domain

`nybem.domain`: This function defines the model domain based on regional extent of the New York Bight watersheds, a user-specified focal area, a downstream extent of a 20m ocean depth contour, and an upstream extent based on bed elevations less than MHHW.


```{r echo=TRUE}
#Functions for rasterizing habitat types
nybem.domain <- function(NYBightWatersheds, Ocean20mDepth, bedelev, MHHW){
  #Insert code
}
```


### Map Habitat Extent and Type

`patch.mapper`: This function maps the extent of NYBEM's six major ecosystem types (Table 3.2) based on user-specified data layers for bed elevation, MLLW, MTL, MHHW, and salinity.  


In NYBEM, the quantity and quality of each ecosystem type may be assessed separately. For instance, ecosystems could be rapidly delineated from empirical data for the existing condition (e.g., field or tide gauge) or modeled hydrodynamic data for future conditions or proposed management actions. These delineated ecosystems can be summarized as an overarching habitat quantity in acres. Ecosystem quality may then be assessed based on patch-specific data and known thresholds in ecological response (e.g., on a normalized 0 to 1 scale indicating ecological quality or function). The product of habitat quality and quantity provides a consistent metric across ecosystem types (i.e., “habitat units”). Here, the terms "habitat" and "ecosystem" are used synonymously to indicate a given patch.


The criteria for delineating ecosystems (Table 3) were subsequently programmed as a suite of logic statements for identifying the salinity zone, tidal zone, or ecosystem / habitat type for any given patch. The following functions input salinity, bed elevation, mean lower low water (MLLW), and mean higher high water (MHHW) and output a numerical code indicating salinity, tidal, and habitat zone as follows.

* *Tidal Zone*: 1 = deep, 2 = subtidal, 3 = intertidal, and 4 = upland
* *Salinity Zone*: 1 = marine, 2 = estuarine, or 3 = freshwater  
* *Habitat Zone / Ecosystem Type*: 1 = upland, 2 = marine, deepwater, 3 = marine, subtidal, 4 = marine, intertidal, 5 = estuarine subtidal, 6 = estuarine intertidal, or 7 = freshwater


```{r echo=TRUE}
#Functions for isolating habitat types

##########
#Labels for tidal zones
ZoneTidal <- c("Deep", "Subtidal", "Intertidal", "Upland")

#Create function for isolating tidal zones
set.tidal.zone <- function(bedelev, MLLW, MHHW){
  #Assign zone
  tidalzone <- ifelse(bedelev <= -2, 1,
          ifelse(bedelev <= MLLW, 2,
          ifelse(bedelev <= MHHW, 3, 
          ifelse(bedelev > MHHW, 4, NA))))
  #Send output
  tidalzone
}

##########
#Labels for salinity zones
ZoneSalinity <- c("Marine", "Estuarine", "Fresh")

#Create function for isolating salinity zones
set.salinity.zone <- function(salinity){
  #Assign zone
  salinityzone <- ifelse(salinity >=30, 1, 
                  ifelse(salinity < 30 & salinity >= 0.5, 2, 
                  ifelse(salinity < 0.5 & salinity >= 0, 3, NA)))
  #Send output
  salinityzone
}

##########
#Labels for habitat zones
ZoneHabitat <- c("Upland", "Marine.Deep", "Marine.Subtidal", "Marine.Intertidal", "Estuarine.Subtidal", "Estuarine.Intertidal", "Freshwater")

#Create function for isolating habitat zones
set.habitat.zone <- function(tidalzone, salinityzone){
  #Assign zone
  habitatzone <- ifelse(tidalzone == 4, 1,
          ifelse(salinityzone == 1 & tidalzone == 1, 2,
          ifelse(salinityzone == 1 & tidalzone == 2, 3,
          ifelse(salinityzone == 1 & tidalzone == 3, 4,
          ifelse(salinityzone == 2 & tidalzone == 1 | tidalzone == 2, 5,
          ifelse(salinityzone == 2 & tidalzone == 3, 6,
          ifelse(salinityzone == 3 & tidalzone == 1 | tidalzone == 2 | tidalzone == 3, 7, NA)))))))
  #Send output
  habitatzone
}
```


### Rasterize Habitat Patches

`patch.rasterizer`: This function rasterizes the output of `patch.mapper` based on a specified grid resolution and aligns that layer with a specified spatial coordinate system. 


```{r echo=TRUE}
#Functions for rasterizing habitat types
patch.rasterizer <- function(patch.mapper.output, grid.resolution, my.coordinate.system){
  #Insert code
}
```